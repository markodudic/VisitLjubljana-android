<!DOCTYPE html>
<html>
  <head>
    <title>Device Properties Example</title>

	<meta name="viewport" content="width=device-width, initial-scale=1"> 
    <script src="assets/js/proj4js-combined.js"></script>
	<script src="assets/js/cordova-2.7.0.js"></script>
	
    <script type="text/javascript" charset="utf-8">
    document.addEventListener("deviceready", onDeviceReady, true);

    var watchID = null;
    var source = null;
    var dest = null;
    var correctionX = 4999750;
    var correctionY = 5000550;
    var minDistance = 10;
	var pOld = new Proj4js.Point(0,0);
	
    //podatki POI-ja
    var points = new Array(new Array(461972, 101050), new Array(461871, 101451));


    function onDeviceReady() {
        //WGS84
    	Proj4js.defs["EPSG:4326"] = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";
        //GK
        Proj4js.defs["EPSG:31469"] = "+proj=tmerc +lat_0=0 +lon_0=15 +k=1 +x_0=5500000 +y_0=0 +ellps=bessel +datum=potsdam +units=m +no_defs";
        source = new Proj4js.Proj('EPSG:4326');	//WGS84
        dest = new Proj4js.Proj('EPSG:31469');	//GK

        //timeout pomeni kolk casa caka na novo pozicijo, enableHighAccuracy ali naj uporabi gps ali samo wifi
        var options = { timeout: 30000, enableHighAccuracy: false };
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
        watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);
    }

    
    function onSuccess(position) {
       var curr = document.getElementById('geolocation');
       var dist = document.getElementById('distance');

       var p = new Proj4js.Point(position.coords.longitude, position.coords.latitude); 
       Proj4js.transform(source, dest, p);  
       
       //preverim èe se je lokacija spremenila saj za 10m
       console.log(Math.abs(p.x - pOld.x));
       if ((Math.abs(p.x - pOld.x) > minDistance) || (Math.abs(p.y - pOld.y) > minDistance)) {
	       pOld = p;
	       var px=p.x-correctionX;
	       var py=p.y-correctionY;
	       
	       curr.innerHTML = 'x: '  + px + '; ' +  'y: ' + py;
	       for (var i=0;i<points.length;i++) {
	       	dist.innerHTML = 'Distance to poi' + i + ": " + lineDistance(px, py, points[i][0], points[i][1])     + ' meters<br>' + dist.innerHTML; 
	       }
       }
    }

    function onError(error) {
    }

    
    function lineDistance( p1x, p1y, p2x, p2y )
    {
      var xs = p2x - p1x;
      xs = xs * xs;
     
      var ys = p2y - p1y;
      ys = ys * ys;
     
      return Math.floor(Math.sqrt( xs + ys ));
    }




    </script>
  </head>
  <body>
    <div id="geolocation">Distance</div>
    <div id="distance"></div>
  </body>
</html>