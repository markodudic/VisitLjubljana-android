<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>ztl mobile flow</title>
	
	<link rel="stylesheet" href="jquery.mobile-1.3.1.min.css" />
	<link rel="stylesheet" href="jquery.mobile.structure-1.3.0.css" />
	<link rel="stylesheet" href="jquery.mobile.theme-1.3.0.css" />
	<link rel="stylesheet" href="ztl.css" />
	<link rel="stylesheet" href="ztl_extend.css" />
	
	<script charset="utf-8" src="cordova-2.7.0.js"></script>
	<script charset="utf-8" src="jquery-1.8.3.min.js"></script>
	<script charset="utf-8" src="jquery.mobile-1.3.0.js"></script>
	<script charset="utf-8" src="jquery.imagemapster.min.js"></script>
	<script charset="utf-8" src="db/db.js"></script>
</head>
<body>

<!--my_visit_list-->
<div data-role="page" id="my_visit_list" data-theme="a">
	<div data-role="header">
		<h1 id="title_one">MyVisit</h1>
	</div>

	<div data-role="content" class="ztl_content" id="my_visit_list_content"></div>
	
	<div data-role="footer" class="footer-docs" data-theme="b" data-position="fixed">
		<div data-role="navbar" data-theme="b">
			<ul>
				<li><a href="#" data-role="button" data-tap-toggle="false" data-icon="home">MyVisit<br></a></li>
				<li><a href="#" data-role="button" data-icon="star">Vodič<br></a></li>
				<li><a href="#" data-role="button" data-icon="info">Vsebina<br></a></li>
				<li><a href="#" data-role="button" data-icon="search">Zemljevid<br></a></li>
				<li><a href="#" data-role="button" data-icon="refresh">Nastavitve<br></a></li>
			</ul>
		</div>
	</div>
</div>

<div data-role="page" id="ztl_load_content1" data-theme="a" class="ztl_container"></div>
<div data-role="page" id="ztl_load_content2" data-theme="a" class="ztl_container"></div>

<script>
	var items 		= null;
	var current 	= 0;
	var used_div 	= "ztl_load_content1";
	
	
	$(function(){
		$('div.ztl_container').on( 'swipeleft', swipeleftHandler );
		$('div.ztl_container').on( 'swiperight', swiperightHandler );
		
		$.getJSON("./db/ztl_db.json", function(json) {
			for (i=0; i<json.items.length; i++) {
				parseItem(json.items[i]);
				items = json.items;
			}
		});
	});
	
	function parseItem(item) {
		var type = 'ztl_event';
		if (item.type == 2) {
			type = 'ztl_location';
		} else if (item.type == 3) {
			type = 'ztl_trip';
		}
		
		var parsed_item = "";
		parsed_item  += '<div class="ztl_list_item '+type+'">';
		parsed_item  += 	'<div class="ztl_list_image">';
		parsed_item	 += 		'<img src="./uploads/images/'+item.title_image+'" style="width:100%;">';
		parsed_item	 +=		'</div>';
		parsed_item	 +=		'<div class="ztl_list_content">';
		parsed_item	 +=			'<div class="ztl_delete">X</div>';
		parsed_item	 +=				'<a href="#" onClick="loadContent(\''+item.id+'\', \'fade\', \'false\')" style="text-decoration:none; color:#000000; font-weight:normal;">';
		parsed_item	 +=					'<span class="ztl_list_header">'+item.title+'</span><br>';
		parsed_item	 +=					item.short_description;
		parsed_item	 +=				'</a>';
		parsed_item	 +=			'</div>';
		parsed_item	 +=	 	'</div>';
		parsed_item	 +=	 	'<div class="ztl_list_info '+type+'">';
		
		if (item.map != "") {
			parsed_item	 +=	 '<div class="ztl_map">map</div>';
		}
		
		if (item.distance != "") {
			parsed_item	 +=	 '<div class="ztl_distance">'+item.distance+' km</div>';
		}
		
		if (item.gps != "") {
			parsed_item	 +=	 '<div class="ztl_gps">gps</div>';
		}
		
		if (item.sound != "") {
			parsed_item	 +=	 '<div class="ztl_sound">sound</div>';
		}

		if (item.calendar != "") {
			parsed_item	 +=	 '<div class="ztl_calendar">'+item.calendar+'</div>';
		}
		
		if (item.time != "") {
			parsed_item	 +=	 '<div class="ztl_watch">'+item.time+'</div>';
		}
		
		parsed_item	 +=	 	'</div>';
		parsed_item	 += '</div>';
		$("#my_visit_list_content").append(parsed_item);
	}
	
	function swipeleftHandler(event){
		var j = 0;
		for (i=0; i<items.length; i++) {
			if (items[i]['id'] == current) {
				j = i-1;
			}
		}
		
		if (j == -1) {
			j = items.length-1;
		}
		
		loadContent(items[j].id, 'slide', false);
	}
	
	function swiperightHandler(event){
		var j = 0;
		for (i=0; i<items.length; i++) {
			if (items[i]['id'] == current) {
				j = i+1;
			}
		}
		
		if (j == items.length) {
			j = 0;
		}
		
		loadContent(items[j].id, 'slide', true);
	}
	
	function loadContent(id, effect, reverse) {
		//to je zdaj malo indijansko // pol bo query
		for (i=0; i<items.length; i++) {
			if (items[i]['id'] == id) {
				current = id;
			
				var parsed_items = "";
				parsed_item  = '<div data-role="header"><h1>'+items[i].title+'</h1></div>';
				parsed_item +=	'<div data-role="content" class="ztl_content">';
				parsed_item +=		'<div class="ztl_navigate_events">';
				parsed_item +=			'<div class="ztl_navigate_events_left"><</div>';
				parsed_item +=			'<div class="ztl_navigate_events_right">></div>';
				parsed_item +=			'<img src="./uploads/images/'+items[i].content_image+'" style="width:100%;">';
				parsed_item +=		'</div>';
				parsed_item +=	'<div class="ztl_datails_info">';
				if (items[i].map != "") {
					parsed_item	 +=	 '<div class="ztl_map">map</div>';
				}
				
				if (items[i].distance != "") {
					parsed_item	 +=	 '<div class="ztl_distance">'+items[i].distance+' km</div>';
				}
				
				if (items[i].gps != "") {
					parsed_item	 +=	 '<div class="ztl_gps">gps</div>';
				}
				
				if (items[i].sound != "") {
					parsed_item	 +=	 '<div class="ztl_sound">sound</div>';
				}

				if (items[i].calendar != "") {
					parsed_item	 +=	 '<div class="ztl_calendar">'+items[i].calendar+'</div>';
				}
				
				if (items[i].time != "") {
					parsed_item	 +=	 '<div class="ztl_watch">'+items[i].time+'</div>';
				}
				parsed_item +=	'</div>';
				parsed_item +=	'<div class="ztl_details_content">'+items[i].content+'</div></div>';

				parsed_item += '<div data-role="footer" class="footer-docs" data-theme="b" data-position="fixed"><div data-role="navbar" data-theme="b"><ul><li><a href="#" data-role="button" data-tap-toggle="false" data-icon="home">MyVisit<br></a></li><li><a href="#" data-role="button" data-icon="star">Vodič<br></a></li><li><a href="#" data-role="button" data-icon="info">Vsebina<br></a></li><li><a href="#" data-role="button" data-icon="search">Zemljevid<br></a></li><li><a href="#" data-role="button" data-icon="refresh">Nastavitve<br></a></li></ul></div>';
				parsed_item += '</div>';

				if (used_div == 'ztl_load_content1') {
					used_div = 'ztl_load_content2';
				} else {
					used_div = 'ztl_load_content1';
				}
				
				$("#"+used_div).html(parsed_item);
				
				$.mobile.changePage( "#"+used_div, {
					transition: effect,
					reverse: reverse,
					changeHash: false
				});
			}
		}
	}
</script>
</body>
</html>